<h1>Smile Posts</h1>

<div id="postsPos">
    <div id="posts">
    </div>

</div>



<script>

    setActive()
    function setActive(){

        const currentPage = window.location.pathname.substring(1)
        let aTags = document.getElementsByTagName('a')
        for (let i = 0; i < 4; i++) {
            if(aTags[i].className === "active"){
                aTags[i].id === aTags[i].className
            }   
        }
        document.getElementById(currentPage).className = "active"
    }


    const postsDiv = document.getElementById("posts");
    let posts;

    loadPosts();

    async function loadPosts(){
        const response = await fetch("/api/posts");
        const result = await response.json();
        posts = result;
        postsDiv.innerHTML = "";
        for(let i in posts){
            console.log(posts)
            const {id, text, userId, date, hours, minutes, categori} = posts[i];

            if(categori!= 'home') {

                const likes = posts[i].likes || 0;

                const resObj = await fetch(`/api/getUserById/${userId}`);
                const foundUser = await resObj.json();
            
                postsDiv.innerHTML += ` <br> 
                    <article class="postArticle">
                        <b id="username">${foundUser.username} - ${categori} post</b>
                        <br>
                        <span id="text${id}">${text}</span>
                        <br>
                        <br>
                        <b id="date"> ${date} </b> <b id="time"> ${hours}:${minutes}</b>
                        <br>
                        <span id="likeCount${id}">${likes}</span> <span>Likes</span> <div id="likeButton${id}"><button onclick="likePost(${id})">Like</button></div>
                    </article> 
                    <br>`;
            }
        }
    }

    async function likePost(id){
        let likeCountElement = document.getElementById("likeCount" + id);
        let likeCount = Number(likeCountElement.innerText);
        likeCountElement.innerText = ++likeCount;
        let buttonDiv = document.getElementById("likeButton" + id);
        buttonDiv.innerHTML = "";
        let likes = likeCount;
        console.log(likes)

        const response = await fetch(`/api/posts/` + id, {
            headers: {
                "content-type": "application/json",
            },
            method: "PUT",
            body: JSON.stringify({likes})
        });
    }

</script>