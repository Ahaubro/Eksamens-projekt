<h2>Login or register page</h2>

<h4>Login or register now to access our smile posts and chatrooms</h4>

<div id="login-container">
    <br>
    <h3 id="itxt">Login at Smiles.com</h3>
    <hr>
    <br>
    <input type="text" placeholder="Username" id="username" />
    </br>
    <input type="password" placeholder="Password" id="password" />
    </br>

    <div>
        <br>
        <button type="submit" onclick="login()" class="loginButton">Login</button>
        <br>
        <br>
        <button onclick="showEditModal()" class="createButton">Opret ny bruger</button>
    </div>
</div>


<h4 id="response"></h4>


<!-- Modal starter her-->

<div id="modal" class="hidden-modal">
    <h3>Create new user</h3>
    <label>Email:</label>
    <input id="reg_email" placeholder="Email"/>
    <br>
    <label>Username:</label>
    <input id="reg_username" placeholder="Username"/>
    <br>
    <label>Password:</label>
    <input id="reg_password" placeholder="Password"/>
    <br>
    <button id="reg-button" onclick="register()">Register new user</button>
    <button onclick="hideEditModal()">Close</button>
</div>
<!-- Modal slutter her -->

<script>



    setActive()
    function setActive(){

        const currentPage = window.location.pathname.substring(1)
        let aTags = document.getElementsByTagName('a')
        for (let i = 0; i < 4; i++) {
            if(aTags[i].className === "active"){
                aTags[i].id === aTags[i].className
            }
        }
        document.getElementById(currentPage).className = "active"
    }


    // Login funktion
    async function login() {

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        let user = {};
        let responseMessage = "";
        if (username && password != undefined) {
            user.username = username;
            user.password = password;
        }
        const res = await fetch(`/auth/login`, {
            headers: {
                "content-type": "application/json",
            },
            method: "POST",
            body: JSON.stringify(user),
        });
        responseMessage = await res.text();

        document.getElementById("response").innerText=responseMessage
    }

    // Register funktion
    async function register() {

        const email = document.getElementById("reg_email").value;
        const username = document.getElementById("reg_username").value;
        const password = document.getElementById("reg_password").value;

        let user = {};
        let responseMessage = "";

        if(username && password && email) {
            user.email = email;
            user.username = username;
            user.password = password;
        }

        // FJERNEs
        console.log(user)

        const res = await fetch(`/auth/signup`, {
                headers: {
                    "content-type": "application/json"
                },
                method: "POST",
                body: JSON.stringify(user)
            });

            if(res.status == 201) {
                responseMessage = await res.text();

                console.log(responseMessage)

                document.getElementById("response").innerText=responseMessage
            } else {
                responseMessage = "Nope"
            }
    }



    // MODAL

    function showEditModal() {
        modal.className = 'shown-modal';
    }

    function hideEditModal() {
        modal.className = 'hidden-modal';
    }

</script>