<h2>Login or register page</h2>

<p>Login or register now to access our smile posts and chatrooms</p>

<div id="login-container">
    <br>
    <h3 id="itxt">Login at Smiles.com</h3>
    <hr>
    <br>
    <input type="text" placeholder="Username" id="username" />
    </br>
    <input type="password" placeholder="Password" id="password" />
    </br>

    <div>
        <br>
        <button type="submit" onclick="login()" class="loginButton">Login</button>
        <br>
        <br>
        <button onclick="showRegisterModal()" class="createButton">Opret ny bruger</button>
    </div>
</div>



<!-- Modal starter her-->

<div id="registerModal" class="hidden-modal">
    <h3>Register now</h3>
    <hr>
    <p>Fill out the information below to register and join Smiles today!</p>
  
    <input id="reg_email" placeholder="Email"/>
    <br>
    <input id="reg_username" placeholder="Username"/>
    <br>
    <input id="reg_password" placeholder="Password"/>

    <div id="regBtnsPos">
        <button id="reg-button" onclick="register()">Register new user</button>
        <br>
        <br>
        <button id="close-regmodal" onclick="hideRegisterModal()">Close</button>
    </div>
    
</div>
<!-- Modal slutter her -->

<p id="response"></p>




<script>

    setActive()
    function setActive(){

        const currentPage = window.location.pathname.substring(1)
        let aTags = document.getElementsByTagName('a')
        for (let i = 0; i < 4; i++) {
            if(aTags[i].className === "active"){
                aTags[i].id === aTags[i].className
            }
        }
        document.getElementById(currentPage).className = "active"
    }


    // Login funktion
    async function login() {

        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;
        let user = {};
        let responseMessage = "";
        if (username && password != undefined) {
            user.username = username;
            user.password = password;
        }
        const res = await fetch(`/auth/login`, {
            headers: {
                "content-type": "application/json",
            },
            method: "POST",
            body: JSON.stringify(user),
        });
        responseMessage = await res.text();

        document.getElementById("response").innerText=responseMessage
    }

    // Register funktion
    async function register() {

        const email = document.getElementById("reg_email").value;
        const username = document.getElementById("reg_username").value;
        const password = document.getElementById("reg_password").value;

        let user = {};
        let responseMessage = "";

        if(username && password && email) {
            user.email = email;
            user.username = username;
            user.password = password;
        }

        // FJERNEs
        console.log(user)

        const res = await fetch(`/auth/signup`, {
                headers: {
                    "content-type": "application/json"
                },
                method: "POST",
                body: JSON.stringify(user)
            });

            responseMessage = await res.text();

            console.log(responseMessage)

            document.getElementById("response").innerText=responseMessage
            
    }



    // MODAL

    function showRegisterModal() {
        registerModal.className = 'shown-modal';
    }

    function hideRegisterModal() {
        registerModal.className = 'hidden-modal';
    }

    document.addEventListener('mouseup', function(event) {
        if (!registerModal.contains(event.target))
            hideRegisterModal();
    });

</script>